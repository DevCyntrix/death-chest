package com.github.devcyntrix.deathchest.listener;

import com.github.devcyntrix.deathchest.DeathChestPlugin;
import org.bukkit.event.EventHandler;
import org.bukkit.event.Listener;
import org.bukkit.event.world.WorldLoadEvent;
import org.bukkit.event.world.WorldUnloadEvent;

/**
 * Loads and unloads the chests if a world is loading or unloading during the runtime
 */
public class WorldListener implements Listener {

    private final DeathChestPlugin plugin;

    public WorldListener(DeathChestPlugin plugin) {
        this.plugin = plugin;
    }

    @EventHandler
    public void onWorldLoad(WorldLoadEvent event) {
        plugin.getDeathChestController().loadChests(event.getWorld());
    }

    @EventHandler
    public void onWorldUnload(WorldUnloadEvent event) {
        plugin.getDeathChestController().unloadChests(event.getWorld(), true);
    }

    // Method to convert the audit json items to the ingame items
//    @EventHandler
//    public void onSneak(PlayerToggleSneakEvent event) {
//        Player player = event.getPlayer();
//        if (!event.isSneaking())
//            return;
//
//        String json = "[{\"v\":3465,\"type\":\"NETHERITE_SWORD\",\"meta\":{\"meta-type\":\"UNSPECIFIC\",\"display-name\":\"{\\\"extra\\\":[{\\\"bold\\\":true,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":true,\\\"color\\\":\\\"red\\\",\\\"text\\\":\\\"x\\\"},{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"gold\\\",\\\"text\\\":\\\"Prestige Sword\\\"},{\\\"bold\\\":true,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":true,\\\"color\\\":\\\"red\\\",\\\"text\\\":\\\"x\\\"}],\\\"text\\\":\\\"\\\"}\",\"lore\":[\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"#EAD931\\\",\\\"text\\\":\\\"Vampire I\\\"}],\\\"text\\\":\\\"\\\"}\",\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"#EA9631\\\",\\\"text\\\":\\\"Double Strike I\\\"}],\\\"text\\\":\\\"\\\"}\",\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"#74EA31\\\",\\\"text\\\":\\\"Exp Hunter I\\\"}],\\\"text\\\":\\\"\\\"}\",\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"dark_gray\\\",\\\"text\\\":\\\"▸ 30% chance to heal for 0.25 heart(s) on hit.\\\"}],\\\"text\\\":\\\"\\\"}\",\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"dark_gray\\\",\\\"text\\\":\\\"▸ 4.8% chance to inflict double damage.\\\"}],\\\"text\\\":\\\"\\\"}\",\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"dark_gray\\\",\\\"text\\\":\\\"▸ Increases exp drop from mobs by 50%.\\\"}],\\\"text\\\":\\\"\\\"}\"],\"enchants\":{\"DAMAGE_ALL\":7,\"DURABILITY\":7,\"FIRE_ASPECT\":5,\"LOOT_BONUS_MOBS\":7,\"KNOCKBACK\":2,\"EXP_HUNTER\":1,\"DOUBLE_STRIKE\":1,\"VAMPIRE\":1},\"Damage\":75,\"PublicBukkitValues\":{\"excellentenchants:lore_size\":\"6i\"}}},{\"v\":3465,\"type\":\"DIAMOND_AXE\",\"meta\":{\"meta-type\":\"UNSPECIFIC\",\"display-name\":\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"red\\\",\\\"text\\\":\\\"Elite Tools\\\"}],\\\"text\\\":\\\"\\\"}\",\"lore\":[\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"#EAD931\\\",\\\"text\\\":\\\"Telekinesis\\\"}],\\\"text\\\":\\\"\\\"}\",\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"dark_gray\\\",\\\"text\\\":\\\"▸ Moves all blocks loot directly to your inventory.\\\"}],\\\"text\\\":\\\"\\\"}\"],\"enchants\":{\"DIG_SPEED\":5,\"DURABILITY\":5,\"SILK_TOUCH\":1,\"TELEKINESIS\":1},\"repair-cost\":1,\"Damage\":348,\"PublicBukkitValues\":{\"excellentenchants:lore_size\":\"2i\"}}},{\"v\":3465,\"type\":\"NETHERITE_PICKAXE\",\"meta\":{\"meta-type\":\"UNSPECIFIC\",\"display-name\":\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":true,\\\"color\\\":\\\"aqua\\\",\\\"text\\\":\\\"l\\\"},{\\\"bold\\\":true,\\\"italic\\\":true,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"yellow\\\",\\\"text\\\":\\\"Giga-Drill\\\"},{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":true,\\\"color\\\":\\\"aqua\\\",\\\"text\\\":\\\"l\\\"}],\\\"text\\\":\\\"\\\"}\",\"lore\":[\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"#74EA31\\\",\\\"text\\\":\\\"Smelter III\\\"}],\\\"text\\\":\\\"\\\"}\",\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"dark_gray\\\",\\\"text\\\":\\\"▸ 30% chance to smelt a block/ore.\\\"}],\\\"text\\\":\\\"\\\"}\"],\"enchants\":{\"DURABILITY\":10,\"LOOT_BONUS_BLOCKS\":5,\"MENDING\":1,\"DIG_SPEED\":10,\"SMELTER\":3},\"repair-cost\":1,\"Damage\":3,\"PublicBukkitValues\":{\"excellentenchants:lore_size\":\"2i\"}}},{\"v\":3465,\"type\":\"DIAMOND_SHOVEL\",\"meta\":{\"meta-type\":\"UNSPECIFIC\",\"display-name\":\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"red\\\",\\\"text\\\":\\\"Elite Tools\\\"}],\\\"text\\\":\\\"\\\"}\",\"enchants\":{\"DIG_SPEED\":5,\"DURABILITY\":5},\"Damage\":535}},{\"v\":3465,\"type\":\"BOW\",\"meta\":{\"meta-type\":\"UNSPECIFIC\",\"Damage\":274}},{\"v\":3465,\"type\":\"DIAMOND_PICKAXE\",\"meta\":{\"meta-type\":\"UNSPECIFIC\",\"display-name\":\"{\\\"extra\\\":[{\\\"bold\\\":true,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"light_purple\\\",\\\"text\\\":\\\"Veinminer Pick\\\"}],\\\"text\\\":\\\"\\\"}\",\"lore\":[\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"#74EA31\\\",\\\"text\\\":\\\"Veinminer I\\\"}],\\\"text\\\":\\\"\\\"}\",\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"dark_gray\\\",\\\"text\\\":\\\"▸ Mines up to 7 blocks of the ore vein at once.\\\"}],\\\"text\\\":\\\"\\\"}\"],\"enchants\":{\"VEINMINER\":1},\"Damage\":3,\"PublicBukkitValues\":{\"excellentenchants:lore_size\":\"2i\"}}},{\"v\":3465,\"type\":\"ARROW\",\"amount\":27},{\"v\":3465,\"type\":\"COOKED_BEEF\",\"amount\":43},{\"v\":3465,\"type\":\"BONE\",\"amount\":25},{\"v\":3465,\"type\":\"DIAMOND_PICKAXE\",\"meta\":{\"meta-type\":\"UNSPECIFIC\",\"enchants\":{\"DURABILITY\":3,\"DIG_SPEED\":4,\"SILK_TOUCH\":1},\"repair-cost\":1,\"Damage\":131}},{\"v\":3465,\"type\":\"LEATHER_LEGGINGS\",\"meta\":{\"meta-type\":\"COLORABLE_ARMOR\",\"display-name\":\"{\\\"extra\\\":[{\\\"bold\\\":true,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"light_purple\\\",\\\"text\\\":\\\"Traveler\\u0027s Trousers\\\"}],\\\"text\\\":\\\"\\\"}\",\"lore\":[\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"yellow\\\",\\\"text\\\":\\\"For when you need to get\\\"}],\\\"text\\\":\\\"\\\"}\",\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"yellow\\\",\\\"text\\\":\\\"somewhere quick...\\\"}],\\\"text\\\":\\\"\\\"}\"],\"enchants\":{\"PROTECTION_FALL\":5,\"DURABILITY\":5,\"SWIFT_SNEAK\":3,\"DEPTH_STRIDER\":3,\"MENDING\":1},\"repair-cost\":1,\"Damage\":1,\"internal\":\"H4sIAAAAAAAA/+NiYOBi4PB0jfdwjfBx5WBgL8gvyczPM2TgLC5ITU2xs7MzYmAAABLysLYlAAAA\"}},{\"v\":3465,\"type\":\"ELYTRA\",\"meta\":{\"meta-type\":\"UNSPECIFIC\",\"display-name\":\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"light_purple\\\",\\\"text\\\":\\\"Ashley\\u0027s Wings\\\"}],\\\"text\\\":\\\"\\\"}\",\"enchants\":{\"THORNS\":3,\"DURABILITY\":5,\"MENDING\":1},\"repair-cost\":1}},{\"v\":3465,\"type\":\"TURTLE_HELMET\",\"meta\":{\"meta-type\":\"ARMOR\",\"display-name\":\"{\\\"extra\\\":[{\\\"bold\\\":false,\\\"italic\\\":false,\\\"underlined\\\":false,\\\"strikethrough\\\":false,\\\"obfuscated\\\":false,\\\"color\\\":\\\"light_purple\\\",\\\"text\\\":\\\"tinybirb\\u0027s Turtle Shell\\\"}],\\\"text\\\":\\\"\\\"}\",\"enchants\":{\"WATER_WORKER\":5,\"OXYGEN\":5,\"PROTECTION_ENVIRONMENTAL\":5,\"DURABILITY\":3,\"MENDING\":1,\"THORNS\":3},\"repair-cost\":15,\"Damage\":1}},{\"v\":3465,\"type\":\"SHIELD\",\"meta\":{\"meta-type\":\"TILE_ENTITY\",\"enchants\":{\"MENDING\":1},\"repair-cost\":1,\"blockMaterial\":\"SHIELD\"}}]";
//                Gson gson = new GsonBuilder()
//                .registerTypeHierarchyAdapter(ItemStack.class, new ItemStackAdapter())
//                .registerTypeHierarchyAdapter(ItemMeta.class, new ItemMetaAdapter())
//                .create();
//        JsonArray array = gson.fromJson(json, JsonArray.class);
//
//        for (JsonElement element : array) {
//            ItemStack item = gson.fromJson(element, ItemStack.class);
//            player.getInventory().addItem(item);
//        }
//
//    }

}
